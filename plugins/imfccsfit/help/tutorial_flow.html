<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=windows-1250">
  <title>2-focus imFCCS Plugin: Tutorial (imFCCS to measure flows, SPIM)</title>
  </head>
  <body>
    $$qf_commondoc_header.start$$ $$qf_commondoc_header.end$$ 
    
    
    
    <h2>Tutorial</h2>
    
    
    <h3>Data &amp; Introduction</h3>
    <p>
$$startbox_note$$
The data for this tutorial is available from <a href="http://www.dkfz.de/Macromol/quickfit/examples.html">http://www.dkfz.de/Macromol/quickfit/examples.html</a> as <tt>beads_flow_2013_08_15.zip</tt>.
$$endbox$$  

In this tutorial, we will evaluate a measurement of TetraSpec multi-colored fluorescent beads diluted in water. Due to a temperature gradient over the sample, a directed flow field formed withing the field-of-view of a SPIM lightsheet microscope (pixel-size: a=400nm, lateral PSF-size w<sub>xy</sub>=600nm, longitudinal PSF-size w<sub>z</sub>=1240nm). An image-series with a temporal resolution of $(\Delta t_{frame}=530\;\mathrm{{\mu}s})$ and 100000 frames was acquired of this sample and is available in the ZIP-file, referenced above. A second image series was acquired on the same beads, but without flow. We will use a global imFCCS fit to determine the speed and direction of the particle flow. Here is a first long-time exposure of the sample, in which the flowing particles appear as horizontal stripes. Especially prominent is a bright aggregate, which appears in white:
<center><a name="tutorial_flow_pic000"><img src="./pic/tutorial_flow_pic000.png" border="1">
</center>
</p>
<p>
The cross-correlation curve to a neighbor can reveil some properties of particle flow, since the cross-correlation function in flow direction has a peak at the time $(\tau_f=\delta_x / v)$, defined by the distance between the cross-correlated pixels $(\delta_x)$ and the flow velocity $(v)$:
<center><a name="tutorial_flow_pic002"><img src="./pic/tutorial_flow_pic002.png" border="1">
</center>
The flow direction is accessible, if cross-correlations in two perpendicular directions are measured and evaluated.</p>
<p>
From each pixel in the measurement of the sample, we can obtain an autocorrelation curve and four cross-correlation curves to the four direct neighbor pixels (pixel-size/distance a=400nm):
<center><a name="tutorial_flow_pic001"><img src="./pic/tutorial_flow_pic001.png" border="1">
</center>
Then we fit five model functions to these five curves and in these link the components of the flow velocity $(\vec{v}=(v_x,v_y)^T)$ and the diffusion coefficients.
</p>

<p>A detailed evaluation of this dataset, including a comparison to the results of some image-flow estimation algorithms can be found in $$jankrieger_phdthesis_ref$$.
</p>


<h3>Downlaod &amp; unzip data</h3>
<p>First go to the internet adress <a href="http://www.dkfz.de/Macromol/quickfit/examples.html">http://www.dkfz.de/Macromol/quickfit/examples.html</a> mentioned above and download the file <tt>beads_flow_2013_08_15.zip</tt>. Unzip its contents to an empty directory on your hard-disk.</p>
<p>If you want to, you can inspect the downloaded dataset, using a scientific image viewer/editor, such as <a href="http://www.fiji.sc/">FIJI (http://www.fiji.sc/)</a>. The ZIP-file contains several TIFF-files, that were acquired during the measurement. The file <tt>beads_flow__s01_c08_000.tif</tt> contains the main measurement and <tt>beads_flow__s01_c08_000_background.tif</tt> is a short sequence of the image sensor dark-signal, acquired with the same acquisition settings, but without illumination. the remaining TIFF-files contain overview images acquired before and after the actual acquisition. The other files contain the setup of the microscope. These are available, if data is acquired with the plugin <a href="$$plugin_info:help:ext_spimb040$$">ext_spimb040 Help</a> and can be read in by the correlator to already determine some meta-data. if these are not available, make sure to know the meta-data of your acquisition (rame-time/frame-rate, pixel-size, ...) before you proceed.</p>



<h3>Correlate Data</h3>

<ol>
    <li>Now we have to correlate the dataset to yield the auto- and cross-correlation curves. To do so, start a new QuickFit project and start the imFCS correlator by clicking on the menu entry <b>Data Items | Insert Raw Data | imFCS: imaging FCS | correlate images and insert</b>. the following correlation dialog will appear:

<center><a name="tutorial_flow_pic003"><img src="./pic/tutorial_flow_pic003.png" border="1">
</center>

</li>
<li>In this dialog, click on <img src=":imaging_fcs/fileopen.png">, select the import filer <b>TinyTIFF</b> and select the file <tt>beads_flow__s01_c08_000.tif</tt> from the directory, in which you extracted the ZIP file. 
<center><a name="tutorial_flow_pic004"><img src="./pic/tutorial_flow_pic004.png" border="1">
</center>
After a click on OK, the correlator dialog will be enabled and some meta-data of the image is already displayed (frames, image size, ...) $$note:Make sure to select the filename-filter <b>TinyTIFF</b>, since only this importer can read the full set of 100000 frames from teh file. the importer libTIFF would only read around 60000 frames!$$</li>
<li>Add the remaining meta-data, which is NOT YET supplied in the correlator window:
<ul>
    <li>camera description/<b>pixel-size</b>: 400*400 nm²</li>
    <li>frame timing/<b>frame-time</b>: 530µs</li>
</ul></li>
<li>The other settings in this dialog should be:
<ul>
    <li><b>frame range</b>: first-last</li>
    <li><b>no cropping</b></li>
    <li><b>no binning</b></li>
    <li>select the file <tt>beads_flow__s01_c08_000_background.tif</tt> as <b>background file</b></li>
    <li><b>no bleach correction</b>: This measurement was taken on fluorescent microspheres, which do not show any bleaching in the given imaging conditions.</li>
    <li><b>no DualView mode</b></li>
    <li><b>cut up into 5 segments</b>, which will create 5 segments from the input dataset (20000 frames each). Each segment is correlated independently and finally we get an average and standard deviation over these five segments as a result. This allows for a proper weighting of the fits, using this standard deviation as an estimation of the error, that we make, when calculating correlation functions.</li>
    <li><b>correlator</b>: Direct correlation with averaging, <b>P=16, m=2</b> and choose a value for <b>S</b>, so the maximum lag-time &tau;<sub>max</sub> is a little bit larger than the segment length in seconds</li>
    <li><b>no N&amp;B records</b></li>
</ul></li>
<li>Finally we have to choose the correlation functions, that should be calculated. Enable:
<ul>
    <li><b>ACF for each pixel</b></li>
    <li><b>CCF to distant pixels</b> and enter the sequence <tt>-1,0;1,0;0,-1;0,1</tt>. In this sequence each pair of integers (separated by ',') specifies one shift vector $(\delta_x,\delta_y)$ for a cross-correlation function. E.g. <tt>-1,0</tt> cross-correlates each pixel with its left direct neighbor. You can specify several different CCFs, that will all be calculated for the datset, by separating the shift vectors by ';'. Therefore the given sequence will cross-correlate each pixel to its left;right;lower;upper neighbor.</li>
</ul></li>
<li>Finally the dialog should look like this:
<center><a name="tutorial_flow_pic005"><img src="./pic/tutorial_flow_pic005.png" border="1">
</center>
</li>
<li>Now you can start the correlation job, by clicking <b>Add Job</b>.</li>
<li>While the correlation is running, you should also correlate the second datafile <tt>TetraSpec__s01_c08_000.tif</tt> (background: <tt>TetraSpec__s01_c08_000_background.tif</tt>), which contains a measurement of the same beads, but without flow. So click on <img src=":imaging_fcs/fileopen.png"> and select teh file <tt>TetraSpec__s01_c08_000.tif</tt>. Then you set all other fields as above. Finally you can also add this job by clicking <b>Add Job</b>.</li>
<li>When all two jobs are finished (<img src=":imaging_fcs/job_done.png">), the you can <b>Close</b> the dialog. QuickFit will now load the datasets into the project:
</li>
</ol>


<h2>References</h2>
<p>$$references$$</p>

  </body>
</html>
